<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="common.css">
    <!--<script src="index.js"></script>-->
    <style>
        #mainMain{
            width: 90%;
            margin: 0 auto;
        }
       #mainMain li{
            display: inline-block;
        }
        #container{
            position:relative;
        }
        .box{
            float:left;
            padding:5px;
        }
        .box-img{
            padding:5px;
            border:1px solid #ccc;
            box-shadow: 0 0 5px #ccc;
            border-radius: 5px;
        }
        .box-img img{
            width:160px;
            height:auto;
        }
    </style>
</head>
<body>
<header>
    <div class="header-left"><i class="iconfont logo">&#xeaaf;</i>网易云音乐
        <div class="arrow">
            <div class="iconfont"><a>&#xe602;</a></div>
            <div class="iconfont"><a>&#xe60f;</a></div>
        </div>
        <div class="search">
            <input type="text" value="搜索音乐，视频，歌词，电台" class="search1">
            <a class="iconfont fangda">&#xe600;</a>
        </div>
    </div>
    <div class="header-right">
        <div class="iconfont touxiang"><a class="iconfont">&#xe611;</a><a class="iconfont denglu">未登录&ensp;&#xe68c;</a></div>.
        <ul class="personal">
            <li><a href="" class="iconfont">&#xe613;</a></li>
            <li><a href="" class="iconfont">&#xe633;</a></li>
            <li><a href="" class="iconfont">&#xe649;</a></li>
        </ul>
        <ul class="setting">
            <li class="iconfont">&#xe609;</li>
            <li class="iconfont">&#xe6c5;</li>
            <li class="iconfont">&#xe61f;</li>
            <li class="iconfont">&#xe642;</li>
        </ul>
    </div>
</header>
<nav>
    <p>推荐</p>
    <ul class="tuijian">
        <li><i class="iconfont" >&#xe639;</i>发现音乐</li>
        <li><i class="iconfont">&#xe62b;</i>私人FM</li>
        <li><i class="iconfont">&#xe610;</i>视频</li>
        <li><i class="iconfont">&#xe64b;</i>朋友</li>
    </ul>
    <p>我的音乐</p>
    <ul>
        <li><i class="iconfont">&#xe65e;</i>本地音乐</li>
        <li><i class="iconfont">&#xe651;</i>下载管理</li>
    </ul>
    <p>创建的歌单</p>
    <ul>
        <li><i class="iconfont">&#xe671;</i>我喜欢的音乐</li>
    </ul>
</nav>
<main>
    <div class="main-nav">
        <ul>
            <li><a>个性推荐</a></li>
            <li><a href="歌单.html">歌单</a></li>
            <li><a href="主播电台.html">主播电台</a></li>
            <li><a href="排行榜.html">排行榜</a></li>
            <li><a href="歌手.html">歌手</a></li>
            <li><a href="最新音乐.html">最新音乐</a></li>
        </ul>
    </div>
    <div id="mainMain">
        <div>语种:
            <ul>
            <li>全部</li>
            <li>华语</li>
            <li>欧美</li>
            <li>日本</li>
            <li>韩国</li>
            <li>其他</li>
            </ul>
        </div>
        <div>
            分类：
            <ul>
                <li>男歌手</li>
                <li>女歌手</li>
                <li>乐队组合</li>
            </ul>
        </div>
        <div>
            <ul id="alp">
                筛选：
            </ul>
        </div>
        <div id="container">
        </div>
    </div>
</main>
<script src="jquery-1.12.4.js"></script>
<script>

   var alp=document.getElementById("alp");
   for(var i=0;i<25;i++)
   {var num=(String.fromCharCode((65+i)));
       var addLi=document.createElement("li");
       addLi.innerHTML=num;
       alp.appendChild(addLi);
   }
    //在开发中不能写死，一般将获取元素的方法封装起来（适应项目需求）
   //瀑布流的唯一标识
   var oParent = document.getElementById('container');//页面加载完成再算；
   var page=1;
//   console.log(oParent);
   quTu(1);
   function  quTu(page){
   $.ajax({
       type:"POST",
       dataType: 'json',
       async:false,
       data : {page,page},
       url:"https://easy-mock.com/mock/5cb6e6e3270aa324bd519b60/topview/Waterfalls",
       success:function (res) {
           var data=res.data;
           list=data.list;//为什么成为局部变量后不行？
           console.log(list);
           for(var i=1,len=list.length;i<len;i++){
               initimg(i);
           }
       }
   });}
   window.addEventListener('load',function(){
       imgLocation('box');
   },false);
   function initimg(i){
       var boxElement=document.createElement("div");
       boxElement.setAttribute("class","box");
       oParent.appendChild(boxElement);
       var boxImg=document.createElement("div");
       boxImg.setAttribute("class","box-img");
       boxElement.appendChild(boxImg);
       var img=document.createElement("img");
       img.src=list[i];
       boxImg.appendChild(img);
   }
   function imgLocation(child) {
       //获取到父级下的子元素
       var aContent = getChilds(child);
       //获取自己元素的宽度
       var imgWidth = aContent[0].offsetWidth;
       //计算一排显示的列数
       var num =~~(document.getElementById("mainMain").offsetWidth / imgWidth);//(要做图片的兼容处理)
       oParent.style.cssText = 'width:' + (imgWidth * num) + 'px;margin:0 auto';
       //动态的计算父级的宽度以居中
       //计算图片的高度
       var heightArr=[];
       aContent.forEach(function (current, index) {
           if (index < num) {//计算当前每列数的高度
               heightArr.push(current.offsetHeight);

           } else {//超出当前列数的序列号
               //获取都最小高度
                var  minHeight=Math.min.apply(null,heightArr);
               current.style.position='absolute';
               //获取图片最小高度的序列号
               var minIndex=getMinHeightIndex(heightArr,minHeight);
               current.style.top=minHeight+'px';
               current.style.left=aContent[minIndex].offsetLeft+'px';
//               console.log(minIndex);
                heightArr[minIndex]=heightArr[minIndex]+current.offsetHeight;
           }
       });
//       console.log(heightArr);
   }
   function getMinHeightIndex(heightArr,minHeight){
       for(var i in heightArr){
           if(heightArr[i]==minHeight){
               return i;
           }
       }
   }
//    imgLocation('box');
   getChilds('box');
    function getChilds(child){
        //存放符合条件的子元素的数组
            var childArr=[];
            var tagsAll =oParent.getElementsByTagName("*");
            for(var i=0,len=tagsAll.length;i<len;i++){
                if(tagsAll[i].className===child ){
                    childArr.push(tagsAll[i]);
                }
            }
        return childArr;
    }
    window.onscroll=function(){
        var scroll=document.documentElement.scrollTop;//已经滚动的距离
        var screen =window.innerHeight;//浏览器高度
        var offsetTop=oParent.offsetTop;
        var height=oParent.offsetHeight;
//        console.log(scroll+screen-offsetTop-height);
        if(scroll+screen-offsetTop-height>550){
            addimg();
        };
    };
    function addimg(){
        page+=1;
        quTu(page);
        imgLocation('box');
    }
</script>
</body>
</html>